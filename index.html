<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Transporte Avanzada</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <style>
        [x-cloak] { display: none !important; }
        .animate-fade { animation: fade 0.3s ease-in-out; }
        @keyframes fade { from { opacity: 0; } to { opacity: 1; } }
        .driver-avatar { width: 40px; height: 40px; }
        
        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 400px;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: slideIn 0.3s ease-out;
        }
        
        .notification.success {
            background-color: #10b981;
            color: white;
        }
        
        .notification.error {
            background-color: #ef4444;
            color: white;
        }
        
        .notification.warning {
            background-color: #f59e0b;
            color: white;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Focus styles for accessibility */
        .focus-visible:focus {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }
        
        /* Loading spinner */
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50" x-data="app()" x-init="init()" x-cloak>
    <!-- Notification System -->
    <div x-show="notification.show" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="transform translate-x-full opacity-0"
         x-transition:enter-end="transform translate-x-0 opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="transform translate-x-0 opacity-100"
         x-transition:leave-end="transform translate-x-full opacity-0"
         :class="'notification ' + notification.type"
         class="notification">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <i :class="notification.icon" class="mr-2"></i>
                <span x-text="notification.message"></span>
            </div>
            <button @click="hideNotification()" class="ml-4 text-white hover:text-gray-200">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>
    <!-- Login Modal -->
    <div x-show="!loggedIn" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
        <div class="bg-white rounded-lg p-8 w-full max-w-md">
            <div x-show="!showRegisterForm">
                <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">Iniciar Sesión</h2>
                <form @submit.prevent="login()">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Usuario</label>
                        <input x-model="loginData.user" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Contraseña</label>
                        <input x-model="loginData.password" type="password" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                    </div>
                    <button type="submit" class="bg-blue-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full mb-4">
                        Ingresar
                    </button>
                </form>
                <div class="text-center">
                    <button @click="showRegisterForm = true" class="text-blue-600 hover:text-blue-800 text-sm">
                        ¿No tienes cuenta? Regístrate aquí
                    </button>
                </div>
            </div>
            
            <div x-show="showRegisterForm">
                <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">Registro de Usuario</h2>
                <form @submit.prevent="registerUser()">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Nombre Completo</label>
                        <input x-model="registerData.fullName" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Usuario</label>
                        <input x-model="registerData.username" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Email</label>
                        <input x-model="registerData.email" type="email" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Teléfono</label>
                        <input x-model="registerData.phone" type="tel" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Contraseña</label>
                        <input x-model="registerData.password" type="password" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                    </div>
                    <button type="submit" class="bg-green-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full mb-4">
                        Solicitar Registro
                    </button>
                </form>
                <div class="text-center">
                    <button @click="showRegisterForm = false; resetRegisterForm()" class="text-blue-600 hover:text-blue-800 text-sm">
                        ¿Ya tienes cuenta? Inicia sesión
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div x-show="loggedIn" class="flex min-h-screen">
        <!-- Sidebar -->
        <div class="w-64 bg-white shadow-lg">
            <div class="flex items-center justify-center h-16 bg-blue-600 text-white">
                <h1 class="text-xl font-bold">Gestión Transporte</h1>
            </div>
            <nav class="mt-6">
                <template x-for="(item, index) in menuItems" :key="index">
                    <div @click="currentView = item.id" :class="{'bg-blue-50 text-blue-700': currentView === item.id}" class="px-6 py-3 text-gray-600 hover:bg-gray-100 cursor-pointer flex items-center">
                        <i :class="item.icon" class="mr-3"></i>
                        <span x-text="item.name"></span>
                    </div>
                </template>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-6">
            <div class="flex justify-between items-center mb-8">
                <h2 x-text="currentViewName" class="text-2xl font-bold"></h2>
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <button @click="exportToExcel()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                            Exportar a Excel
                        </button>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="flex items-center">
                            <img src="https://placehold.co/36x36" alt="Foto de perfil del usuario" class="rounded-full mr-2">
                            <div class="flex flex-col">
                                <span x-text="currentUser?.fullName || currentUser?.username || 'Usuario'" class="text-gray-700 font-medium text-sm"></span>
                                <span x-text="getRoleText(currentUser?.role)" class="text-gray-500 text-xs"></span>
                            </div>
                        </div>
                        <button @click="logout()" class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 transition-colors">
                            <i class="fas fa-sign-out-alt mr-1"></i>Cerrar Sesión
                        </button>
                    </div>
                </div>
            </div>

            <!-- Dashboard View -->
            <div x-show="currentView === 'dashboard'" class="animate-fade">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-lg p-6 shadow">
                        <h3 class="text-gray-500 text-sm font-semibold mb-2">Transportadores</h3>
                        <p x-text="drivers.length" class="text-3xl font-bold text-blue-600"></p>
                    </div>
                    <div class="bg-white rounded-lg p-6 shadow">
                        <h3 class="text-gray-500 text-sm font-semibold mb-2">Entregas Pendientes</h3>
                        <p x-text="deliveries.filter(d => d.status === 'pending').length" class="text-3xl font-bold text-red-600"></p>
                    </div>
                    <div class="bg-white rounded-lg p-6 shadow">
                        <h3 class="text-gray-500 text-sm font-semibold mb-2">Entregas Completadas</h3>
                        <p x-text="deliveries.filter(d => d.status === 'completed').length" class="text-3xl font-bold text-green-600"></p>
                    </div>
                    <div class="bg-white rounded-lg p-6 shadow">
                        <h3 class="text-gray-500 text-sm font-semibold mb-2">Asignaciones Hoy</h3>
                        <p x-text="getTodayAssignments().length" class="text-3xl font-bold text-purple-600"></p>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-white rounded-lg shadow mb-8">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-semibold">Acciones Rápidas</h3>
                    </div>
                    <div class="p-6 grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button @click="showDriverModal('new')" class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">
                            Añadir Transportador
                        </button>
                        <button @click="currentView = 'deliveries'" class="bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700">
                            Ver Todas las Entregas
                        </button>
                        <button @click="exportToExcel()" class="bg-indigo-600 text-white py-2 px-4 rounded hover:bg-indigo-700">
                            Exportar Datos
                        </button>
                    </div>
                </div>
            </div>

            <!-- Drivers View -->
            <div x-show="currentView === 'drivers'" class="animate-fade">
                <div class="bg-white rounded-lg shadow mb-6">
                    <div class="p-4 flex justify-between items-center border-b border-gray-200">
                        <h3 class="text-lg font-semibold">Transportadores</h3>
                        <button @click="showDriverModal('new')" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                            Añadir Transportador
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Vehículo</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <template x-for="driver in drivers" :key="driver.id">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div>
                                                <div x-text="driver.name" class="font-medium"></div>
                                                <div x-text="driver.phone" class="text-sm text-gray-500"></div>
                                            </div>
                                        </td>
                                        <td x-text="driver.vehicle" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            <button @click="showDriverModal('edit', driver)" class="text-blue-600 hover:text-blue-900 mr-3">
                                                Editar
                                            </button>
                                            <button @click="deleteDriver(driver)" class="text-red-600 hover:text-red-900">
                                                Eliminar
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Deliveries View -->
            <div x-show="currentView === 'deliveries'" class="animate-fade">
                <div class="bg-white rounded-lg shadow mb-6">
                    <div class="p-4 flex justify-between items-center border-b border-gray-200">
                        <h3 class="text-lg font-semibold">Documentos para Entrega</h3>
                        <div>
                            <select x-model="deliveryFilter" @change="filterDeliveries()" class="border rounded px-3 py-1 mr-2">
                                <option value="all">Todos</option>
                                <option value="pending">Pendientes</option>
                                <option value="in_progress">En curso</option>
                                <option value="completed">Completados</option>
                            </select>
                            <button @click="showDeliveryModal('new')" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mr-2">
                                Nuevo Documento
                            </button>
                            <button @click="showImportModal()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                                Importar Excel
                            </button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Documento</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prioridad</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <template x-for="delivery in filteredDeliveries" :key="delivery.id">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="font-medium text-gray-900" x-text="delivery.documentNumber"></div>
                                            <div class="text-sm text-gray-500" x-text="'ID: #' + delivery.id"></div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span x-text="delivery.documentType" 
                                                  :class="getDocumentTypeClass(delivery.documentType)"
                                                  class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"></span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span x-text="delivery.priority || 'Normal'" 
                                                  :class="getPriorityClass(delivery.priority)"
                                                  class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"></span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span x-text="getStatusText(delivery.status)" 
                                                  :class="getStatusClass(delivery.status)"
                                                  class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"></span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            <template x-if="delivery.status === 'pending'">
                                                <button @click="showAssignmentModal(delivery)" class="text-blue-600 hover:text-blue-900 mr-3">
                                                    Asignar
                                                </button>
                                            </template>
                                            <template x-if="delivery.status === 'in_progress'">
                                                <button @click="showAssignmentModal(delivery)" class="text-yellow-600 hover:text-yellow-900 mr-3">
                                                    Reasignar
                                                </button>
                                            </template>
                                            <button @click="showDeliveryModal('edit', delivery)" class="text-blue-600 hover:text-blue-900 mr-3">
                                                Editar
                                            </button>
                                            <button @click="deleteDelivery(delivery)" class="text-red-600 hover:text-red-900">
                                                Eliminar
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Assignments View -->
            <div x-show="currentView === 'assignments'" class="animate-fade">
                <div class="bg-white rounded-lg shadow mb-6">
                    <div class="p-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold">Asignaciones Activas</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Documento</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Transportador</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <template x-for="assignment in activeAssignments" :key="assignment.id">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="font-medium text-gray-900" x-text="getDeliveryById(assignment.deliveryId)?.documentNumber"></div>
                                            <div class="text-sm text-gray-500" x-text="getDeliveryById(assignment.deliveryId)?.documentType"></div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <div class="flex-shrink-0 h-10 w-10">
                                                    <div class="h-10 w-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-semibold text-sm" 
                                                         x-text="getDriverInitials(getDriverById(assignment.driverId)?.name)">
                                                    </div>
                                                </div>
                                                <div class="ml-3">
                                                    <div x-text="getDriverById(assignment.driverId)?.name" class="font-medium text-gray-900"></div>
                                                    <div x-text="getDriverById(assignment.driverId)?.vehicle" class="text-sm text-gray-500"></div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span x-text="getStatusText(getDeliveryById(assignment.deliveryId)?.status)" 
                                                  :class="getStatusClass(getDeliveryById(assignment.deliveryId)?.status)"
                                                  class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"></span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            <button @click="completeAssignment(assignment)" class="text-green-600 hover:text-green-900 mr-3">
                                                Completar
                                            </button>
                                            <button @click="showAssignmentModal(getDeliveryById(assignment.deliveryId), assignment)" class="text-blue-600 hover:text-blue-900 mr-3">
                                                Reasignar
                                            </button>
                                            <button @click="cancelAssignment(assignment)" class="text-red-600 hover:text-red-900">
                                                Cancelar
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Users Management View -->
            <div x-show="currentView === 'users'" class="animate-fade">
                <!-- Pending Users Section -->
                <div class="bg-white rounded-lg shadow mb-6" x-show="currentUser && currentUser.role === 'admin'">
                    <div class="p-4 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-semibold">Solicitudes de Registro Pendientes</h3>
                            <span x-show="pendingUsers.length > 0" 
                                  x-text="pendingUsers.length + ' solicitudes'" 
                                  class="bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-sm font-medium"></span>
                        </div>
                    </div>
                    <div x-show="pendingUsers.length === 0" class="p-6 text-center text-gray-500">
                        <i class="fas fa-user-check text-4xl mb-4 text-gray-300"></i>
                        <p>No hay solicitudes de registro pendientes</p>
                    </div>
                    <div x-show="pendingUsers.length > 0" class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Usuario</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Información de Contacto</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha Solicitud</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <template x-for="user in pendingUsers" :key="user.id">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <div class="flex-shrink-0 h-10 w-10">
                                                    <div class="h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center text-gray-600 font-semibold text-sm" 
                                                         x-text="getDriverInitials(user.fullName)">
                                                    </div>
                                                </div>
                                                <div class="ml-4">
                                                    <div x-text="user.fullName" class="text-sm font-medium text-gray-900"></div>
                                                    <div x-text="'@' + user.username" class="text-sm text-gray-500"></div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div x-text="user.email" class="text-sm text-gray-900"></div>
                                            <div x-text="user.phone" class="text-sm text-gray-500"></div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            <div x-text="new Date(user.requestDate).toLocaleDateString()"></div>
                                            <div x-text="new Date(user.requestDate).toLocaleTimeString()" class="text-xs"></div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <button @click="showUserApprovalModal(user)" class="text-green-600 hover:text-green-900 mr-3">
                                                <i class="fas fa-check mr-1"></i>Aprobar
                                            </button>
                                            <button @click="rejectUser(user)" class="text-red-600 hover:text-red-900">
                                                <i class="fas fa-times mr-1"></i>Rechazar
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Active Users Section -->
                <div class="bg-white rounded-lg shadow mb-6">
                    <div class="p-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold">Usuarios Activos del Sistema</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Usuario</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rol</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" x-show="currentUser && currentUser.role === 'admin'">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <template x-for="user in validUsers" :key="user.username">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <div class="flex-shrink-0 h-10 w-10">
                                                    <div class="h-10 w-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-semibold text-sm" 
                                                         x-text="user.username.charAt(0).toUpperCase()">
                                                    </div>
                                                </div>
                                                <div class="ml-4">
                                                    <div x-text="user.fullName || user.username" class="text-sm font-medium text-gray-900"></div>
                                                    <div x-text="'@' + user.username" class="text-sm text-gray-500"></div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span x-text="getRoleText(user.role)" 
                                                  :class="getRoleClass(user.role)"
                                                  class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"></span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                                Activo
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-show="currentUser && currentUser.role === 'admin'">
                                            <template x-if="user.username !== currentUser.username">
                                                <button @click="deactivateUser(user)" class="text-red-600 hover:text-red-900">
                                                    Desactivar
                                                </button>
                                            </template>
                                            <template x-if="user.username === currentUser.username">
                                                <span class="text-gray-400">Usuario actual</span>
                                            </template>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Driver Modal -->
    <div x-show="driverModalOpen" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <h2 x-text="editDriverMode ? 'Editar Transportador' : 'Nuevo Transportador'" class="text-xl font-bold mb-4"></h2>
            <form @submit.prevent="editDriverMode ? updateDriver() : addDriver()">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Nombre completo</label>
                    <input x-model="currentDriver.name" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Teléfono</label>
                    <input x-model="currentDriver.phone" type="tel" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Vehículo</label>
                    <select x-model="currentDriver.vehicle" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                        <option value="">Seleccionar...</option>
                        <option value="Motocicleta">Motocicleta</option>
                        <option value="Camioneta">Camioneta</option>
                        <option value="Camión">Camión</option>
                        <option value="Furgoneta">Furgoneta</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-3">
                    <button @click="driverModalOpen = false" type="button" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                        Cancelar
                    </button>
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                        <span x-text="editDriverMode ? 'Actualizar' : 'Guardar'"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delivery Modal -->
    <div x-show="deliveryModalOpen" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-lg">
            <h2 x-text="editDeliveryMode ? 'Editar Documento' : 'Nuevo Documento'" class="text-xl font-bold mb-4"></h2>
            <form @submit.prevent="editDeliveryMode ? updateDelivery() : addDelivery()">
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Tipo de Documento</label>
                        <select x-model="currentDelivery.documentType" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                            <option value="">Seleccionar...</option>
                            <option value="FACTURA DE VENTA">FACTURA DE VENTA</option>
                            <option value="REMISION">REMISION</option>
                            <option value="ORDEN DE COMPRA">ORDEN DE COMPRA</option>
                            <option value="GUIA DE DESPACHO">GUIA DE DESPACHO</option>
                            <option value="NOTA DE ENTREGA">NOTA DE ENTREGA</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Número de Documento</label>
                        <input x-model="currentDelivery.documentNumber" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" placeholder="Ej: FV-2024-001">
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Descripción/Observaciones</label>
                    <textarea x-model="currentDelivery.description" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" rows="3" placeholder="Detalles adicionales del documento"></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Estado</label>
                        <select x-model="currentDelivery.status" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                            <option value="pending">Pendiente</option>
                            <option value="in_progress">En curso</option>
                            <option value="completed">Completado</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Prioridad</label>
                        <select x-model="currentDelivery.priority" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                            <option value="normal">Normal</option>
                            <option value="high">Alta</option>
                            <option value="urgent">Urgente</option>
                        </select>
                    </div>
                </div>
                <div class="flex justify-end space-x-3">
                    <button @click="deliveryModalOpen = false" type="button" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                        Cancelar
                    </button>
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                        <span x-text="editDeliveryMode ? 'Actualizar' : 'Guardar'"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Import Excel Modal -->
    <div x-show="importModalOpen" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-lg">
            <h2 class="text-xl font-bold mb-4">Importar Documentos desde Excel</h2>
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2">Seleccionar archivo Excel</label>
                <input type="file" @change="handleFileUpload($event)" accept=".xlsx,.xls" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                <p class="text-sm text-gray-500 mt-2">Formato esperado: Tipo de Documento | Número de Documento | Descripción | Estado | Prioridad</p>
            </div>
            <div x-show="importPreview.length > 0" class="mb-4">
                <h3 class="text-lg font-semibold mb-2">Vista Previa (<span x-text="importPreview.length"></span> registros)</h3>
                <div class="max-h-60 overflow-y-auto border rounded">
                    <table class="min-w-full text-sm">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-2 py-1 text-left">Tipo</th>
                                <th class="px-2 py-1 text-left">Número</th>
                                <th class="px-2 py-1 text-left">Descripción</th>
                                <th class="px-2 py-1 text-left">Estado</th>
                                <th class="px-2 py-1 text-left">Prioridad</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="(item, index) in importPreview.slice(0, 5)" :key="index">
                                <tr class="border-t">
                                    <td x-text="item.documentType" class="px-2 py-1"></td>
                                    <td x-text="item.documentNumber" class="px-2 py-1"></td>
                                    <td x-text="item.description" class="px-2 py-1"></td>
                                    <td x-text="item.status" class="px-2 py-1"></td>
                                    <td x-text="item.priority" class="px-2 py-1"></td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                    <div x-show="importPreview.length > 5" class="p-2 text-center text-gray-500">
                        ... y <span x-text="importPreview.length - 5"></span> registros más
                    </div>
                </div>
            </div>
            <div x-show="importErrors.length > 0" class="mb-4">
                <h3 class="text-lg font-semibold mb-2 text-red-600">Errores encontrados</h3>
                <div class="max-h-40 overflow-y-auto bg-red-50 border border-red-200 rounded p-2">
                    <template x-for="(error, index) in importErrors" :key="index">
                        <div x-text="error" class="text-red-700 text-sm"></div>
                    </template>
                </div>
            </div>
            <div class="flex justify-end space-x-3">
                <button @click="closeImportModal()" type="button" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                    Cancelar
                </button>
                <button @click="downloadTemplate()" type="button" class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700">
                    Descargar Plantilla
                </button>
                <button @click="importDocuments()" :disabled="importPreview.length === 0 || importErrors.length > 0" type="button" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed">
                    Importar <span x-text="importPreview.length"></span> Documentos
                </button>
            </div>
        </div>
    </div>

    <!-- Assignment Modal -->
    <div x-show="assignmentModalOpen" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <h2 x-text="editAssignmentMode ? 'Editar Asignación' : 'Asignar Entrega'" class="text-xl font-bold mb-4"></h2>
            <form @submit.prevent="editAssignmentMode ? updateAssignment() : createAssignment()">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Entrega</label>
                    <input :value="'#' + currentAssignment.deliveryId" disabled class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 bg-gray-100 focus:outline-none focus:shadow-outline">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Transportador</label>
                    <select x-model="currentAssignment.driverId" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                        <option value="">Seleccionar...</option>
                        <template x-for="driver in availableDrivers" :key="driver.id">
                            <option :value="driver.id" x-text="driver.name + ' (' + driver.vehicle + ')'"></option>
                        </template>
                    </select>
                </div>
                <div class="flex justify-end space-x-3">
                    <button @click="assignmentModalOpen = false" type="button" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                        Cancelar
                    </button>
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                        <span x-text="editAssignmentMode ? 'Actualizar' : 'Asignar'"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- User Approval Modal -->
    <div x-show="userApprovalModalOpen" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <h2 class="text-xl font-bold mb-4">Aprobar Usuario</h2>
            <div class="mb-4">
                <div class="bg-gray-50 p-4 rounded-lg mb-4">
                    <h3 class="font-semibold text-gray-800 mb-2">Información del Usuario</h3>
                    <p class="text-sm text-gray-600"><strong>Nombre:</strong> <span x-text="currentUserForApproval?.fullName"></span></p>
                    <p class="text-sm text-gray-600"><strong>Usuario:</strong> <span x-text="currentUserForApproval?.username"></span></p>
                    <p class="text-sm text-gray-600"><strong>Email:</strong> <span x-text="currentUserForApproval?.email"></span></p>
                    <p class="text-sm text-gray-600"><strong>Teléfono:</strong> <span x-text="currentUserForApproval?.phone"></span></p>
                </div>
                <label class="block text-gray-700 text-sm font-bold mb-2">Asignar Rol</label>
                <select x-model="selectedUserRole" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    <option value="">Seleccionar rol...</option>
                    <option value="operator">Operador</option>
                    <option value="supervisor">Supervisor</option>
                    <option value="admin">Administrador</option>
                </select>
                <p class="text-xs text-gray-500 mt-1">
                    <strong>Operador:</strong> Acceso básico al sistema<br>
                    <strong>Supervisor:</strong> Gestión de operaciones<br>
                    <strong>Administrador:</strong> Control total del sistema
                </p>
            </div>
            <div class="flex justify-end space-x-3">
                <button @click="userApprovalModalOpen = false" type="button" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                    Cancelar
                </button>
                <button @click="confirmUserApproval()" :disabled="!selectedUserRole" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed">
                    <i class="fas fa-check mr-1"></i>Aprobar Usuario
                </button>
            </div>
        </div>
    </div>

    <!-- Alpine JS -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.12.0/dist/cdn.min.js" defer></script>
    <script>
        function app() {
            return {
                // Authentication
                loggedIn: false,
                loginData: { user: '', password: '' },
                sessionTimeout: null,
                validUsers: [
                    { username: 'admin', password: 'admin123', role: 'admin' },
                    { username: 'supervisor', password: 'super123', role: 'supervisor' },
                    { username: 'operador', password: 'oper123', role: 'operator' }
                ],
                currentUser: null,
                
                // Registration system
                showRegisterForm: false,
                registerData: {
                    fullName: '',
                    username: '',
                    email: '',
                    phone: '',
                    password: ''
                },
                pendingUsers: [],
                
                // Notification system
                notification: {
                    show: false,
                    message: '',
                    type: 'success', // success, error, warning
                    icon: 'fas fa-check-circle'
                },
                
                // Navigation
                currentView: 'dashboard',
                menuItems: [
                    { id: 'dashboard', name: 'Dashboard', icon: 'fas fa-tachometer-alt' },
                    { id: 'drivers', name: 'Transportadores', icon: 'fas fa-truck' },
                    { id: 'deliveries', name: 'Entregas', icon: 'fas fa-boxes' },
                    { id: 'assignments', name: 'Asignaciones', icon: 'fas fa-tasks' },
                    { id: 'users', name: 'Usuarios', icon: 'fas fa-users' }
                ],
                
                // Data
                drivers: [],
                deliveries: [],
                assignments: [],
                deliveryFilter: 'all',
                
                // Modals
                driverModalOpen: false,
                editDriverMode: false,
                currentDriver: { id: '', name: '', phone: '', vehicle: '', available: true, avatar: 'https://placehold.co/40x40' },
                
                deliveryModalOpen: false,
                editDeliveryMode: false,
                currentDelivery: { 
                    id: '', 
                    documentType: '', 
                    documentNumber: '', 
                    client: '', 
                    address: '', 
                    description: '', 
                    status: 'pending', 
                    priority: 'normal',
                    createdAt: new Date().toISOString()
                },
                
                assignmentModalOpen: false,
                editAssignmentMode: false,
                currentAssignment: { id: '', deliveryId: '', driverId: '', assignmentTime: new Date().toISOString().slice(0,16) },
                
                // Import Excel Modal
                importModalOpen: false,
                importPreview: [],
                importErrors: [],
                
                // User Approval Modal
                userApprovalModalOpen: false,
                currentUserForApproval: null,
                selectedUserRole: '',
                
                // computed
                get currentViewName() {
                    return this.menuItems.find(item => item.id === this.currentView)?.name || 'Dashboard';
                },
                
                get availableDrivers() {
                    return this.drivers.filter(d => d.available);
                },
                
                get activeAssignments() {
                    return this.assignments.filter(a => {
                        const delivery = this.getDeliveryById(a.deliveryId);
                        return delivery && delivery.status !== 'completed';
                    });
                },
                
                get filteredDeliveries() {
                    if (this.deliveryFilter === 'all') {
                        return this.deliveries;
                    }
                    return this.deliveries.filter(d => d.status === this.deliveryFilter);
                },
                
                get pendingDeliveries() {
                    return this.deliveries.filter(d => d.status === 'pending');
                },
                
                get completedDeliveries() {
                    return this.deliveries.filter(d => d.status === 'completed');
                },
                
                // methods
                init() {
                    this.loadData();
                    this.setupSessionTimeout();
                },
                
                // Authentication & Security
                login() {
                    try {
                        const user = this.validateCredentials(this.loginData.user, this.loginData.password);
                        if (user) {
                            this.loggedIn = true;
                            this.currentUser = user;
                            this.loadData();
                            this.setupSessionTimeout();
                            this.showNotification('Bienvenido al sistema', 'success', 'fas fa-check-circle');
                        } else {
                            this.showNotification('Credenciales inválidas', 'error', 'fas fa-exclamation-circle');
                        }
                    } catch (error) {
                        this.showNotification('Error al iniciar sesión', 'error', 'fas fa-exclamation-triangle');
                        console.error('Login error:', error);
                    }
                },
                
                validateCredentials(username, password) {
                    if (!username || !password) {
                        return null;
                    }
                    return this.validUsers.find(user => 
                        user.username === username && user.password === password
                    );
                },
                
                setupSessionTimeout() {
                    // Clear existing timeout
                    if (this.sessionTimeout) {
                        clearTimeout(this.sessionTimeout);
                    }
                    
                    // Set 30 minute timeout
                    this.sessionTimeout = setTimeout(() => {
                        this.logout();
                        this.showNotification('Sesión expirada por inactividad', 'warning', 'fas fa-clock');
                    }, 30 * 60 * 1000);
                },
                
                logout() {
                    this.loggedIn = false;
                    this.currentUser = null;
                    if (this.sessionTimeout) {
                        clearTimeout(this.sessionTimeout);
                    }
                },
                
                // Notification System
                showNotification(message, type = 'success', icon = 'fas fa-check-circle') {
                    this.notification = {
                        show: true,
                        message,
                        type,
                        icon
                    };
                    
                    // Auto hide after 5 seconds
                    setTimeout(() => {
                        this.hideNotification();
                    }, 5000);
                },
                
                hideNotification() {
                    this.notification.show = false;
                },
                
                // Data Management with Error Handling
                loadData() {
                    try {
                        const savedDrivers = localStorage.getItem('transportadores_drivers');
                        const savedDeliveries = localStorage.getItem('transportadores_deliveries');
                        const savedAssignments = localStorage.getItem('transportadores_assignments');
                        const savedPendingUsers = localStorage.getItem('transportadores_pending_users');
                        
                        this.drivers = savedDrivers ? this.validateAndParseData(savedDrivers, 'drivers') : [
                            { id: '1', name: 'Carlos Méndez', phone: '3001234567', vehicle: 'Motocicleta', available: true, avatar: 'https://placehold.co/40x40/3b82f6/ffffff?text=CM' },
                            { id: '2', name: 'María Rodríguez', phone: '3007654321', vehicle: 'Camioneta', available: true, avatar: 'https://placehold.co/40x40/3b82f6/ffffff?text=MR' },
                            { id: '3', name: 'Juan Pérez', phone: '3001112233', vehicle: 'Motocicleta', available: false, avatar: 'https://placehold.co/40x40/3b82f6/ffffff?text=JP' }
                        ];
                        
                        this.deliveries = savedDeliveries ? this.validateAndParseData(savedDeliveries, 'deliveries') : [
                            { id: '1', documentType: 'FACTURA DE VENTA', documentNumber: 'FV-2024-001', client: 'Tienda Don Pancho', address: 'Calle 123 #45-67', description: 'Pedido de alimentos', status: 'pending', priority: 'normal', createdAt: new Date().toISOString() },
                            { id: '2', documentType: 'REMISION', documentNumber: 'RM-2024-002', client: 'Supermercado La Abundancia', address: 'Avenida Principal #100-23', description: 'Productos de limpieza', status: 'in_progress', priority: 'high', createdAt: new Date().toISOString() },
                            { id: '3', documentType: 'GUIA DE DESPACHO', documentNumber: 'GD-2024-003', client: 'Restaurante El Fogón', address: 'Carrera 8 #12-34', description: 'Insumos para cocina', status: 'completed', priority: 'normal', createdAt: new Date().toISOString() }
                        ];
                        
                        this.assignments = savedAssignments ? this.validateAndParseData(savedAssignments, 'assignments') : [
                            { id: '1', deliveryId: '2', driverId: '1', assignmentTime: new Date().toISOString() }
                        ];
                        
                        this.pendingUsers = savedPendingUsers ? this.validateAndParseData(savedPendingUsers, 'pendingUsers') : [];
                        
                        // Check for admin notifications about pending users
                        if (this.currentUser && this.currentUser.role === 'admin' && this.pendingUsers.length > 0) {
                            this.showNotification(`Tienes ${this.pendingUsers.length} solicitudes de registro pendientes`, 'warning', 'fas fa-user-clock');
                        }
                        
                        this.showNotification('Datos cargados correctamente', 'success', 'fas fa-check-circle');
                    } catch (error) {
                        console.error('Error loading data:', error);
                        this.showNotification('Error al cargar datos del sistema', 'error', 'fas fa-exclamation-triangle');
                        this.loadDefaultData();
                    }
                },
                
                validateAndParseData(jsonString, dataType) {
                    try {
                        const data = JSON.parse(jsonString);
                        if (!Array.isArray(data)) {
                            throw new Error(`Invalid ${dataType} data format`);
                        }
                        return data;
                    } catch (error) {
                        console.error(`Error parsing ${dataType}:`, error);
                        this.showNotification(`Error en datos de ${dataType}, usando valores por defecto`, 'warning', 'fas fa-exclamation-triangle');
                        return [];
                    }
                },
                
                loadDefaultData() {
                    this.drivers = [
                        { id: '1', name: 'Carlos Méndez', phone: '3001234567', vehicle: 'Motocicleta', available: true, avatar: 'https://placehold.co/40x40/3b82f6/ffffff?text=CM' },
                        { id: '2', name: 'María Rodríguez', phone: '3007654321', vehicle: 'Camioneta', available: true, avatar: 'https://placehold.co/40x40/3b82f6/ffffff?text=MR' },
                        { id: '3', name: 'Juan Pérez', phone: '3001112233', vehicle: 'Motocicleta', available: false, avatar: 'https://placehold.co/40x40/3b82f6/ffffff?text=JP' }
                    ];
                    
                    this.deliveries = [
                        { id: '1', documentType: 'FACTURA DE VENTA', documentNumber: 'FV-2024-001', client: 'Tienda Don Pancho', address: 'Calle 123 #45-67', description: 'Pedido de alimentos', status: 'pending', priority: 'normal', createdAt: new Date().toISOString() },
                        { id: '2', documentType: 'REMISION', documentNumber: 'RM-2024-002', client: 'Supermercado La Abundancia', address: 'Avenida Principal #100-23', description: 'Productos de limpieza', status: 'in_progress', priority: 'high', createdAt: new Date().toISOString() },
                        { id: '3', documentType: 'GUIA DE DESPACHO', documentNumber: 'GD-2024-003', client: 'Restaurante El Fogón', address: 'Carrera 8 #12-34', description: 'Insumos para cocina', status: 'completed', priority: 'normal', createdAt: new Date().toISOString() }
                    ];
                    
                    this.assignments = [
                        { id: '1', deliveryId: '2', driverId: '1', assignmentTime: new Date().toISOString() }
                    ];
                },
                
                saveData() {
                    try {
                        localStorage.setItem('transportadores_drivers', JSON.stringify(this.drivers));
                        localStorage.setItem('transportadores_deliveries', JSON.stringify(this.deliveries));
                        localStorage.setItem('transportadores_assignments', JSON.stringify(this.assignments));
                        localStorage.setItem('transportadores_pending_users', JSON.stringify(this.pendingUsers));
                        this.showNotification('Datos guardados correctamente', 'success', 'fas fa-save');
                    } catch (error) {
                        console.error('Error saving data:', error);
                        this.showNotification('Error al guardar datos', 'error', 'fas fa-exclamation-triangle');
                    }
                },
                
                // User Registration Functions
                registerUser() {
                    try {
                        // Validate registration data
                        if (!this.registerData.fullName || !this.registerData.username || 
                            !this.registerData.email || !this.registerData.phone || !this.registerData.password) {
                            this.showNotification('Todos los campos son obligatorios', 'error', 'fas fa-exclamation-circle');
                            return;
                        }
                        
                        // Check if username already exists
                        const existingUser = this.validUsers.find(u => u.username === this.registerData.username);
                        const pendingUser = this.pendingUsers.find(u => u.username === this.registerData.username);
                        
                        if (existingUser || pendingUser) {
                            this.showNotification('El nombre de usuario ya existe', 'error', 'fas fa-exclamation-circle');
                            return;
                        }
                        
                        // Create pending user
                        const newPendingUser = {
                            id: Date.now().toString(),
                            fullName: this.registerData.fullName.trim(),
                            username: this.registerData.username.trim(),
                            email: this.registerData.email.trim(),
                            phone: this.registerData.phone.trim(),
                            password: this.registerData.password,
                            requestDate: new Date().toISOString(),
                            status: 'pending'
                        };
                        
                        this.pendingUsers.push(newPendingUser);
                        localStorage.setItem('transportadores_pending_users', JSON.stringify(this.pendingUsers));
                        
                        this.showNotification('Solicitud de registro enviada. El administrador revisará tu solicitud.', 'success', 'fas fa-check-circle');
                        this.resetRegisterForm();
                        this.showRegisterForm = false;
                        
                    } catch (error) {
                        console.error('Registration error:', error);
                        this.showNotification('Error al procesar el registro', 'error', 'fas fa-exclamation-triangle');
                    }
                },
                
                resetRegisterForm() {
                    this.registerData = {
                        fullName: '',
                        username: '',
                        email: '',
                        phone: '',
                        password: ''
                    };
                },
                
                // User Management Functions
                showUserApprovalModal(user) {
                    this.currentUserForApproval = user;
                    this.selectedUserRole = '';
                    this.userApprovalModalOpen = true;
                },
                
                confirmUserApproval() {
                    try {
                        if (!this.selectedUserRole) {
                            this.showNotification('Debe seleccionar un rol para el usuario', 'error', 'fas fa-exclamation-circle');
                            return;
                        }
                        
                        const user = this.currentUserForApproval;
                        
                        // Add user to valid users with selected role
                        const newUser = {
                            username: user.username,
                            password: user.password,
                            role: this.selectedUserRole,
                            fullName: user.fullName,
                            email: user.email,
                            phone: user.phone,
                            approvedDate: new Date().toISOString(),
                            approvedBy: this.currentUser.username
                        };
                        
                        this.validUsers.push(newUser);
                        
                        // Remove from pending users
                        this.pendingUsers = this.pendingUsers.filter(u => u.id !== user.id);
                        
                        // Save changes
                        localStorage.setItem('transportadores_valid_users', JSON.stringify(this.validUsers));
                        localStorage.setItem('transportadores_pending_users', JSON.stringify(this.pendingUsers));
                        
                        // Close modal and reset
                        this.userApprovalModalOpen = false;
                        this.currentUserForApproval = null;
                        this.selectedUserRole = '';
                        
                        this.showNotification(`Usuario ${user.fullName} aprobado exitosamente como ${this.getRoleText(newUser.role)}`, 'success', 'fas fa-check-circle');
                        
                    } catch (error) {
                        console.error('Error approving user:', error);
                        this.showNotification('Error al aprobar usuario', 'error', 'fas fa-exclamation-triangle');
                    }
                },
                
                approveUser(user) {
                    try {
                        if (confirm(`¿Aprobar el registro de ${user.fullName}?`)) {
                            // Add user to valid users with operator role by default
                            const newUser = {
                                username: user.username,
                                password: user.password,
                                role: 'operator',
                                fullName: user.fullName,
                                email: user.email,
                                phone: user.phone,
                                approvedDate: new Date().toISOString(),
                                approvedBy: this.currentUser.username
                            };
                            
                            this.validUsers.push(newUser);
                            
                            // Remove from pending users
                            this.pendingUsers = this.pendingUsers.filter(u => u.id !== user.id);
                            
                            // Save changes
                            localStorage.setItem('transportadores_valid_users', JSON.stringify(this.validUsers));
                            localStorage.setItem('transportadores_pending_users', JSON.stringify(this.pendingUsers));
                            
                            this.showNotification(`Usuario ${user.fullName} aprobado exitosamente`, 'success', 'fas fa-check-circle');
                        }
                    } catch (error) {
                        console.error('Error approving user:', error);
                        this.showNotification('Error al aprobar usuario', 'error', 'fas fa-exclamation-triangle');
                    }
                },
                
                rejectUser(user) {
                    try {
                        if (confirm(`¿Rechazar el registro de ${user.fullName}? Esta acción no se puede deshacer.`)) {
                            // Remove from pending users
                            this.pendingUsers = this.pendingUsers.filter(u => u.id !== user.id);
                            
                            // Save changes
                            localStorage.setItem('transportadores_pending_users', JSON.stringify(this.pendingUsers));
                            
                            this.showNotification(`Solicitud de ${user.fullName} rechazada`, 'warning', 'fas fa-times-circle');
                        }
                    } catch (error) {
                        console.error('Error rejecting user:', error);
                        this.showNotification('Error al rechazar usuario', 'error', 'fas fa-exclamation-triangle');
                    }
                },
                
                deactivateUser(user) {
                    try {
                        if (confirm(`¿Desactivar el usuario ${user.username}? Esta acción no se puede deshacer.`)) {
                            // Remove from valid users
                            this.validUsers = this.validUsers.filter(u => u.username !== user.username);
                            
                            // Save changes
                            localStorage.setItem('transportadores_valid_users', JSON.stringify(this.validUsers));
                            
                            this.showNotification(`Usuario ${user.username} desactivado`, 'warning', 'fas fa-user-slash');
                        }
                    } catch (error) {
                        console.error('Error deactivating user:', error);
                        this.showNotification('Error al desactivar usuario', 'error', 'fas fa-exclamation-triangle');
                    }
                },
                
                getRoleText(role) {
                    const roleMap = {
                        'admin': 'Administrador',
                        'supervisor': 'Supervisor',
                        'operator': 'Operador'
                    };
                    return roleMap[role] || role;
                },
                
                getRoleClass(role) {
                    const classMap = {
                        'admin': 'bg-red-100 text-red-800',
                        'supervisor': 'bg-blue-100 text-blue-800',
                        'operator': 'bg-green-100 text-green-800'
                    };
                    return classMap[role] || 'bg-gray-100 text-gray-800';
                },
                
                // Validation Functions
                validateDriver(driver) {
                    const errors = [];
                    
                    if (!driver.name || driver.name.trim().length < 2) {
                        errors.push('El nombre debe tener al menos 2 caracteres');
                    }
                    
                    if (!driver.phone || !this.validatePhone(driver.phone)) {
                        errors.push('El teléfono debe tener 10 dígitos');
                    }
                    
                    if (!driver.vehicle || driver.vehicle.trim().length === 0) {
                        errors.push('Debe seleccionar un vehículo');
                    }
                    
                    if (!driver.avatar || !this.validateURL(driver.avatar)) {
                        errors.push('La URL de la foto no es válida');
                    }
                    
                    return errors;
                },
                
                validateDelivery(delivery) {
                    const errors = [];
                    
                    if (!delivery.client || delivery.client.trim().length < 2) {
                        errors.push('El nombre del cliente debe tener al menos 2 caracteres');
                    }
                    
                    if (!delivery.address || delivery.address.trim().length < 5) {
                        errors.push('La dirección debe tener al menos 5 caracteres');
                    }
                    
                    if (!delivery.status || !['pending', 'in_progress', 'completed'].includes(delivery.status)) {
                        errors.push('Estado de entrega inválido');
                    }
                    
                    return errors;
                },
                
                validatePhone(phone) {
                    const phoneRegex = /^[0-9]{10}$/;
                    return phoneRegex.test(phone.replace(/\s/g, ''));
                },
                
                validateURL(url) {
                    try {
                        new URL(url);
                        return true;
                    } catch {
                        return false;
                    }
                },
                
                generateSecureId() {
                    return Date.now().toString() + Math.random().toString(36).substr(2, 9);
                },
                
                filterDeliveries() {
                    if (this.deliveryFilter === 'all') {
                        this.filteredDeliveries = [...this.deliveries];
                    } else {
                        this.filteredDeliveries = this.deliveries.filter(d => d.status === this.deliveryFilter);
                    }
                },
                
                getTodayAssignments() {
                    const today = new Date().toDateString();
                    return this.assignments.filter(a => 
                        new Date(a.assignmentTime).toDateString() === today
                    );
                },
                
                showDriverModal(mode, driver = null) {
                    if (mode === 'edit' && driver) {
                        this.currentDriver = { ...driver };
                        this.editDriverMode = true;
                    } else {
                        this.currentDriver = { id: '', name: '', phone: '', vehicle: '', available: true, avatar: 'https://placehold.co/40x40' };
                        this.editDriverMode = false;
                    }
                    this.driverModalOpen = true;
                },
                
                addDriver() {
                    // Generate a simple ID for demo purposes
                    this.currentDriver.id = Date.now().toString();
                    this.drivers.push(this.currentDriver);
                    this.saveData();
                    this.driverModalOpen = false;
                },
                
                updateDriver() {
                    const index = this.drivers.findIndex(d => d.id === this.currentDriver.id);
                    if (index !== -1) {
                        this.drivers[index] = { ...this.currentDriver };
                        this.saveData();
                    }
                    this.driverModalOpen = false;
                },
                
                deleteDriver(driver) {
                    if (confirm(`¿Estás seguro de eliminar a ${driver.name}?`)) {
                        this.drivers = this.drivers.filter(d => d.id !== driver.id);
                        this.saveData();
                    }
                },
                
                showDeliveryModal(mode, delivery = null) {
                    if (mode === 'edit' && delivery) {
                        this.currentDelivery = { ...delivery };
                        this.editDeliveryMode = true;
                    } else {
                        this.currentDelivery = { id: '', client: '', address: '', description: '', status: 'pending', createdAt: new Date().toISOString() };
                        this.editDeliveryMode = false;
                    }
                    this.deliveryModalOpen = true;
                },
                
                addDelivery() {
                    this.currentDelivery.id = Date.now().toString();
                    this.deliveries.push(this.currentDelivery);
                    this.saveData();
                    this.filterDeliveries();
                    this.deliveryModalOpen = false;
                },
                
                updateDelivery() {
                    const index = this.deliveries.findIndex(d => d.id === this.currentDelivery.id);
                    if (index !== -1) {
                        this.deliveries[index] = { ...this.currentDelivery };
                        this.saveData();
                        this.filterDeliveries();
                    }
                    this.deliveryModalOpen = false;
                },
                
                deleteDelivery(delivery) {
                    if (confirm(`¿Estás seguro de eliminar la entrega para ${delivery.client}?`)) {
                        this.deliveries = this.deliveries.filter(d => d.id !== delivery.id);
                        this.saveData();
                        this.filterDeliveries();
                    }
                },
                
                showAssignmentModal(delivery, assignment = null) {
                    this.currentAssignment.deliveryId = delivery.id;
                    
                    if (assignment) {
                        this.currentAssignment.id = assignment.id;
                        this.currentAssignment.driverId = assignment.driverId;
                        this.currentAssignment.assignmentTime = assignment.assignmentTime;
                        this.editAssignmentMode = true;
                    } else {
                        this.currentAssignment.id = '';
                        this.currentAssignment.driverId = '';
                        this.currentAssignment.assignmentTime = new Date().toISOString().slice(0,16);
                        this.editAssignmentMode = false;
                    }
                    
                    this.assignmentModalOpen = true;
                },
                
                createAssignment() {
                    const deliveryIndex = this.deliveries.findIndex(d => d.id === this.currentAssignment.deliveryId);
                    if (deliveryIndex !== -1) {
                        // Mark delivery as in progress
                        this.deliveries[deliveryIndex].status = 'in_progress';
                        
                        // Create assignment
                        this.currentAssignment.id = Date.now().toString();
                        this.assignments.push({ ...this.currentAssignment });
                        
                        // Mark driver as unavailable
                        const driverIndex = this.drivers.findIndex(d => d.id === this.currentAssignment.driverId);
                        if (driverIndex !== -1) {
                            this.drivers[driverIndex].available = false;
                        }
                        
                        this.saveData();
                        this.assignmentModalOpen = false;
                        this.filterDeliveries();
                    }
                },
                
                updateAssignment() {
                    const assignmentIndex = this.assignments.findIndex(a => a.id === this.currentAssignment.id);
                    if (assignmentIndex !== -1) {
                        // Update assignment
                        this.assignments[assignmentIndex] = { ...this.currentAssignment };
                        
                        // Update driver status if changed
                        const newDriver = this.drivers.find(d => d.id === this.currentAssignment.driverId);
                        const oldDriverId = this.assignments[assignmentIndex].driverId;
                        
                        if (newDriver && newDriver.id !== oldDriverId) {
                            // Free old driver
                            const oldDriverIndex = this.drivers.findIndex(d => d.id === oldDriverId);
                            if (oldDriverIndex !== -1) {
                                this.drivers[oldDriverIndex].available = true;
                            }
                            
                            // Mark new driver as busy
                            newDriver.available = false;
                        }
                        
                        this.saveData();
                    }
                    
                    this.assignmentModalOpen = false;
                },
                
                completeAssignment(assignment) {
                    if (confirm('¿Marcar esta entrega como completada?')) {
                        // Update delivery status
                        const deliveryIndex = this.deliveries.findIndex(d => d.id === assignment.deliveryId);
                        if (deliveryIndex !== -1) {
                            this.deliveries[deliveryIndex].status = 'completed';
                        }
                        
                        // Free the driver
                        const driverIndex = this.drivers.findIndex(d => d.id === assignment.driverId);
                        if (driverIndex !== -1) {
                            this.drivers[driverIndex].available = true;
                        }
                        
                        this.saveData();
                        this.filterDeliveries();
                    }
                },
                
                cancelAssignment(assignment) {
                    if (confirm('¿Cancelar esta asignación?')) {
                        // Update delivery status to pending
                        const deliveryIndex = this.deliveries.findIndex(d => d.id === assignment.deliveryId);
                        if (deliveryIndex !== -1) {
                            this.deliveries[deliveryIndex].status = 'pending';
                        }
                        
                        // Free the driver
                        const driverIndex = this.drivers.findIndex(d => d.id === assignment.driverId);
                        if (driverIndex !== -1) {
                            this.drivers[driverIndex].available = true;
                        }
                        
                        // Remove assignment
                        this.assignments = this.assignments.filter(a => a.id !== assignment.id);
                        
                        this.saveData();
                        this.filterDeliveries();
                    }
                },
                
                // Helper methods
                getStatusText(status) {
                    const statusMap = {
                        pending: 'Pendiente',
                        in_progress: 'En curso',
                        completed: 'Completada'
                    };
                    return statusMap[status] || '';
                },
                
                getStatusClass(status) {
                    const classMap = {
                        pending: 'bg-yellow-100 text-yellow-800',
                        in_progress: 'bg-blue-100 text-blue-800',
                        completed: 'bg-green-100 text-green-800'
                    };
                    return classMap[status] || '';
                },
                
                getDriverById(id) {
                    return this.drivers.find(d => d.id === id);
                },
                
                getDeliveryById(id) {
                    return this.deliveries.find(d => d.id === id);
                },
                
                getDocumentTypeClass(documentType) {
                    const classMap = {
                        'FACTURA DE VENTA': 'bg-blue-100 text-blue-800',
                        'REMISION': 'bg-green-100 text-green-800',
                        'ORDEN DE COMPRA': 'bg-purple-100 text-purple-800',
                        'GUIA DE DESPACHO': 'bg-orange-100 text-orange-800',
                        'NOTA DE ENTREGA': 'bg-indigo-100 text-indigo-800'
                    };
                    return classMap[documentType] || 'bg-gray-100 text-gray-800';
                },
                
                getPriorityClass(priority) {
                    const classMap = {
                        'normal': 'bg-gray-100 text-gray-800',
                        'high': 'bg-yellow-100 text-yellow-800',
                        'urgent': 'bg-red-100 text-red-800'
                    };
                    return classMap[priority] || 'bg-gray-100 text-gray-800';
                },
                
                getDriverInitials(name) {
                    if (!name) return '';
                    return name.split(' ')
                        .map(word => word.charAt(0).toUpperCase())
                        .slice(0, 2)
                        .join('');
                },
                
                // Excel Import Functions
                showImportModal() {
                    this.importModalOpen = true;
                    this.importPreview = [];
                    this.importErrors = [];
                },
                
                closeImportModal() {
                    this.importModalOpen = false;
                    this.importPreview = [];
                    this.importErrors = [];
                },
                
                handleFileUpload(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const sheetName = workbook.SheetNames[0];
                            const worksheet = workbook.Sheets[sheetName];
                            const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                            
                            this.processImportData(jsonData);
                        } catch (error) {
                            this.showNotification('Error al leer el archivo Excel', 'error', 'fas fa-exclamation-triangle');
                            console.error('Excel read error:', error);
                        }
                    };
                    reader.readAsArrayBuffer(file);
                },
                
                processImportData(data) {
                    this.importPreview = [];
                    this.importErrors = [];
                    
                    if (data.length < 2) {
                        this.importErrors.push('El archivo debe contener al menos una fila de encabezados y una fila de datos');
                        return;
                    }
                    
                    // Skip header row
                    const rows = data.slice(1);
                    
                    rows.forEach((row, index) => {
                        const rowNumber = index + 2; // +2 because we skip header and arrays are 0-indexed
                        
                        if (row.length < 5) {
                            this.importErrors.push(`Fila ${rowNumber}: Faltan columnas (se esperan 5: Tipo, Número, Descripción, Estado, Prioridad)`);
                            return;
                        }
                        
                        const [documentType, documentNumber, description, status, priority] = row;
                        
                        // Validate required fields
                        if (!documentType || !documentNumber) {
                            this.importErrors.push(`Fila ${rowNumber}: Tipo de documento y número son obligatorios`);
                            return;
                        }
                        
                        // Validate document type
                        const validDocumentTypes = ['FACTURA DE VENTA', 'REMISION', 'ORDEN DE COMPRA', 'GUIA DE DESPACHO', 'NOTA DE ENTREGA'];
                        if (!validDocumentTypes.includes(documentType)) {
                            this.importErrors.push(`Fila ${rowNumber}: Tipo de documento inválido. Debe ser uno de: ${validDocumentTypes.join(', ')}`);
                            return;
                        }
                        
                        // Validate status
                        const validStatuses = ['pending', 'in_progress', 'completed', 'Pendiente', 'En curso', 'Completado'];
                        let normalizedStatus = status;
                        if (status === 'Pendiente') normalizedStatus = 'pending';
                        else if (status === 'En curso') normalizedStatus = 'in_progress';
                        else if (status === 'Completado') normalizedStatus = 'completed';
                        
                        if (!validStatuses.includes(status)) {
                            this.importErrors.push(`Fila ${rowNumber}: Estado inválido. Debe ser: Pendiente, En curso, o Completado`);
                            return;
                        }
                        
                        // Validate priority
                        const validPriorities = ['normal', 'high', 'urgent', 'Normal', 'Alta', 'Urgente'];
                        let normalizedPriority = priority || 'normal';
                        if (priority === 'Normal') normalizedPriority = 'normal';
                        else if (priority === 'Alta') normalizedPriority = 'high';
                        else if (priority === 'Urgente') normalizedPriority = 'urgent';
                        
                        if (priority && !validPriorities.includes(priority)) {
                            this.importErrors.push(`Fila ${rowNumber}: Prioridad inválida. Debe ser: Normal, Alta, o Urgente`);
                            return;
                        }
                        
                        // Check for duplicate document numbers
                        const existingDoc = this.deliveries.find(d => d.documentNumber === documentNumber);
                        if (existingDoc) {
                            this.importErrors.push(`Fila ${rowNumber}: El número de documento ${documentNumber} ya existe`);
                            return;
                        }
                        
                        // Check for duplicates in preview
                        const duplicateInPreview = this.importPreview.find(d => d.documentNumber === documentNumber);
                        if (duplicateInPreview) {
                            this.importErrors.push(`Fila ${rowNumber}: Número de documento duplicado en el archivo: ${documentNumber}`);
                            return;
                        }
                        
                        // Add to preview
                        this.importPreview.push({
                            documentType: documentType.trim(),
                            documentNumber: documentNumber.trim(),
                            description: description ? description.trim() : '',
                            status: normalizedStatus,
                            priority: normalizedPriority
                        });
                    });
                    
                    if (this.importPreview.length > 0) {
                        this.showNotification(`${this.importPreview.length} documentos listos para importar`, 'success', 'fas fa-check-circle');
                    }
                    
                    if (this.importErrors.length > 0) {
                        this.showNotification(`${this.importErrors.length} errores encontrados en el archivo`, 'warning', 'fas fa-exclamation-triangle');
                    }
                },
                
                importDocuments() {
                    if (this.importPreview.length === 0) {
                        this.showNotification('No hay documentos para importar', 'warning', 'fas fa-exclamation-triangle');
                        return;
                    }
                    
                    if (this.importErrors.length > 0) {
                        this.showNotification('Corrija los errores antes de importar', 'error', 'fas fa-exclamation-circle');
                        return;
                    }
                    
                    try {
                        let importedCount = 0;
                        
                        this.importPreview.forEach(item => {
                            const newDelivery = {
                                id: Date.now().toString() + Math.random().toString(36).substr(2, 5),
                                documentType: item.documentType,
                                documentNumber: item.documentNumber,
                                description: item.description,
                                status: item.status,
                                priority: item.priority,
                                createdAt: new Date().toISOString()
                            };
                            
                            this.deliveries.push(newDelivery);
                            importedCount++;
                        });
                        
                        this.saveData();
                        this.filterDeliveries();
                        this.closeImportModal();
                        
                        this.showNotification(`${importedCount} documentos importados exitosamente`, 'success', 'fas fa-check-circle');
                        
                        // Switch to deliveries view to show imported documents
                        this.currentView = 'deliveries';
                        
                    } catch (error) {
                        console.error('Import error:', error);
                        this.showNotification('Error al importar documentos', 'error', 'fas fa-exclamation-triangle');
                    }
                },
                
                downloadTemplate() {
                    // Create template data
                    const templateData = [
                        ['Tipo de Documento', 'Número de Documento', 'Descripción', 'Estado', 'Prioridad'],
                        ['FACTURA DE VENTA', 'FV-2024-001', 'Ejemplo de factura de venta', 'Pendiente', 'Normal'],
                        ['REMISION', 'RM-2024-002', 'Ejemplo de remisión', 'Pendiente', 'Alta'],
                        ['ORDEN DE COMPRA', 'OC-2024-003', 'Ejemplo de orden de compra', 'Pendiente', 'Urgente'],
                        ['GUIA DE DESPACHO', 'GD-2024-004', 'Ejemplo de guía de despacho', 'En curso', 'Normal'],
                        ['NOTA DE ENTREGA', 'NE-2024-005', 'Ejemplo de nota de entrega', 'Completado', 'Normal']
                    ];
                    
                    // Create worksheet
                    const ws = XLSX.utils.aoa_to_sheet(templateData);
                    
                    // Set column widths
                    ws['!cols'] = [
                        { wch: 20 }, // Tipo de Documento
                        { wch: 20 }, // Número de Documento
                        { wch: 30 }, // Descripción
                        { wch: 15 }, // Estado
                        { wch: 15 }  // Prioridad
                    ];
                    
                    // Create workbook
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, "Plantilla Documentos");
                    
                    // Export template
                    XLSX.writeFile(wb, "plantilla_documentos.xlsx");
                    
                    this.showNotification('Plantilla descargada exitosamente', 'success', 'fas fa-download');
                },
                
                // Excel Export
                exportToExcel() {
                    // Prepare data for export
                    const data = [
                        ['Tipo de Documento', 'Número de Documento', 'Descripción', 'Estado', 'Prioridad', 'Transportador', 'Fecha Asignación']
                    ];
                    
                    this.deliveries.forEach(delivery => {
                        const assignment = this.assignments.find(a => a.deliveryId === delivery.id);
                        const driver = assignment ? this.getDriverById(assignment.driverId) : null;
                        
                        data.push([
                            delivery.documentType,
                            delivery.documentNumber,
                            delivery.description || '',
                            this.getStatusText(delivery.status),
                            delivery.priority === 'normal' ? 'Normal' : delivery.priority === 'high' ? 'Alta' : 'Urgente',
                            driver ? driver.name : 'No asignado',
                            assignment ? new Date(assignment.assignmentTime).toLocaleString() : ''
                        ]);
                    });
                    
                    // Create worksheet
                    const ws = XLSX.utils.aoa_to_sheet(data);
                    
                    // Set column widths
                    ws['!cols'] = [
                        { wch: 20 }, // Tipo de Documento
                        { wch: 20 }, // Número de Documento
                        { wch: 30 }, // Descripción
                        { wch: 15 }, // Estado
                        { wch: 15 }, // Prioridad
                        { wch: 20 }, // Transportador
                        { wch: 20 }  // Fecha Asignación
                    ];
                    
                    // Create workbook
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, "Documentos");
                    
                    // Export to file
                    XLSX.writeFile(wb, "documentos_transporte.xlsx");
                    
                    this.showNotification('Datos exportados exitosamente', 'success', 'fas fa-download');
                }
            }
        }
    </script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous">
</body>
</html>
